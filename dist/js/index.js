"use strict";window.addEventListener("load",function(){addListener();closeListener();document.getElementById("syncOpen").addEventListener("click",function(){klassenAuswahl(document.getElementById("klasseSelect"));if(GLOBALS.klasse&&GLOBALS.klasse!="-"){klassenSyncHandler("uebersicht.htm")}else{alert("Es wurde keine Klasse ausgew\xE4hlt !")}});document.getElementById("btn_Delete").addEventListener("click",function(){klassenAuswahl(document.getElementById("klasseSelect"));if(window.confirm("Bist du sicher, dass du die gesamte Klasse:\n\n"+GLOBALS.klassenbezeichnung+" (id: "+GLOBALS.klasse.substring(0,6)+")\n\nl\xF6schen m\xF6chtest ?")){klassenDeleteHandler(GLOBALS.klasse)}});document.getElementById("export").addEventListener("click",function(){klassenAuswahl(document.getElementById("klasseSelect"));if(GLOBALS.klasse&&GLOBALS.klasse!="-"){popUp("item0Export")}else{alert("Es wurde keine Klasse ausgew\xE4hlt !")}});document.getElementById("import").addEventListener("click",function(){if(GLOBALS.AUTH){popUp("item0Import")}else{alert("Dein Account ist nicht f\xFCr den Import auf den Server berechtigt.")}});document.getElementById("closeSync").addEventListener("click",function(){var syncStatus=document.getElementById("syncStatus");syncStatus.classList.remove("ok");syncStatus.classList.remove("error");syncStatus.style.width="0";document.getElementById("syncText").innerHTML="Synchronisiere";document.getElementById("syncInnerText").innerHTML="";var buttons=document.getElementById("item0Sync").getElementsByClassName("button");for(var i=0;i<buttons.length;i++){buttons[i].classList.add("hide")}});document.getElementById("indexKlassen").getElementsByTagName("span")[1].innerHTML="Version: "+GLOBALS.appversion;Schuljahre();sessionStorage.removeItem("leistung");sessionStorage.removeItem("klasse");sessionStorage.setItem("lastview","item1");if(GLOBALS.knownDevice){initDB(function(){db_readGeneric(function(localAccount){sync_getAccount(listIdx_Select,localAccount)},1,"account")});document.getElementById("userID").value=GLOBALS.userID}else{GLOBALS.userID="Nobody";GLOBALS.passW="-";popUp("item0First")}window.addEventListener("beforeinstallprompt",function(e){console.log("SW: Verz\xF6gere das Install-Prompt");e.preventDefault();GLOBALS["deferredPrompt"]=e;var old_pop=document.querySelector("#item0First div a");popUpSwitch(old_pop,"item0Install")})});function addToHomeScreen(thisElement){GLOBALS["deferredPrompt"].prompt();popUpClose(thisElement,false,true);GLOBALS["deferredPrompt"].userChoice.then(function(choiceResult){if(choiceResult.outcome==="accepted"){console.log("SW: Prompt accepted")}else{console.log("SW: Prompt not accepted")}GLOBALS["deferredPrompt"]=null;window.location.reload()}).catch(function(err){console.log("SW:",err);setTimeout(function(){window.location.reload()},3000)})}function settingsAllgemein(){GLOBALS.userID=document.getElementById("userID").value||"Niemand";GLOBALS.passW=document.getElementById("passW").value||"false";var errorMsg=document.querySelector("#item0First .msg.error");errorMsg.classList.add("hide");errorMsg.innerHTML="";testCreds(setAuth);return}function setAuth(status){var errorMsg;if(status!="200"&&status!="ok"){document.getElementById("passW").value="";var msg="Fehler beim Anmelden ("+status+")";if(status=="401"||status=="403"){localStorage.removeItem("TeacherTab");localStorage.setItem("auth",false);localStorage.setItem("passW",GLOBALS.passW);msg+=":<br>Emailadresse oder Passwort sind falsch !"}else if(status=="400"||status=="0"){msg+=":<br>Der Server ist nicht erreichbar. Bist du online ?"}else if(status=="500"){msg+=":<br>Uuups ! Auf dem Server ist etwas schiefgegangen. Probier es bitte nochmal..."}errorMsg=document.querySelector("#item0First .msg.error");errorMsg.innerHTML=msg;errorMsg.classList.remove("hide");checkAuth()}else{errorMsg=document.querySelector("#item0First .msg.error");errorMsg.innerHTML="";localStorage.setItem("userID",GLOBALS.userID);localStorage.setItem("passW",GLOBALS.passW);localStorage.setItem("auth",true);localStorage.setItem("TeacherTab",true);var thisElement=document.querySelector("#item0First .OK");popUpClose(thisElement);checkAuth();setTimeout(function(){window.location.reload()},550)}return}function listIdx_Select(account){var result=account.klassenliste;var sel=document.getElementById("klasseSelect");var clone=sel.cloneNode(true);clone.innerHTML="";var optCount=0;var opt;opt=new Option("- bitte w\xE4hlen -");opt.value="-";clone.appendChild(opt);if(result){var keylist=[];for(var key in result){keylist.push([key,result[key]])}keylist.sort(compareKlassen);for(var i=0;i<keylist.length;i++){var hash=keylist[i][0];if(GLOBALS.PRO||account.local.indexOf(hash)!==-1){var bezeichnung=result[hash].bezeichnung;opt=new Option(bezeichnung);opt.value=hash;clone.appendChild(opt);optCount+=1}}}sel.parentNode.replaceChild(clone,sel);document.getElementById("indexKlassen").getElementsByTagName("span")[0].innerHTML="Insgesamt "+optCount+" Klassen in deinem Account";var auth_status=document.getElementById("AuthStatus");var text=auth_status.getElementsByClassName("statusText")[0];var info=auth_status.getElementsByClassName("statusInfo")[0];if(GLOBALS.PRO){text.classList.add("pro");if(GLOBALS.unlimited.indexOf(account.validDate)===-1){text.innerHTML="PRO Account bis "+datum(true,account.validDate);info.innerHTML="<a href=\"https://my.teachertab.de/home.php\" title=\"Zu deinem Account\" class=\"button\">unbegrenzt Pro holen</a>"}else{text.innerHTML="PRO Account !";info.parentNode.removeChild(info)}}else if(!navigator.onLine){text.innerHTML="Offline";text.classList.add("offline");info.parentNode.removeChild(info)}else{text.innerHTML="Basic Account";text.classList.add("basic");info.innerHTML="<a href=\"https://my.teachertab.de/home.php\" title=\"Zu deinem Account\" class=\"button\">wechsel zu Pro !</a>"}}function klassenAuswahl(selectbox){var klasseSelect=selectbox;if(klasseSelect.value!=="null"&&klasseSelect.value!==""){GLOBALS.klasse=klasseSelect.value;GLOBALS.klassenbezeichnung=klasseSelect.selectedOptions[0].innerHTML;sessionStorage.setItem("klasse",GLOBALS.klasse);sessionStorage.setItem("klassenbezeichnung",GLOBALS.klassenbezeichnung)}else{alert("Es wurde keine Klasse ausgew\xE4hlt !")}}function addKlasse(thisElement){var nameKlasse=document.getElementById("nameKlasse");var jahrKlasse=document.getElementById("jahrKlasse");var fachKlasse=document.getElementById("fachKlasse");if(nameKlasse.value&&nameKlasse.value!=""){var newKlasse=jahrKlasse.value+" - "+fachKlasse.value+" "+nameKlasse.value;var newId=uniqueClassID(newKlasse);sessionStorage.setItem("klasse",newId);db_neueKlasse(function(){window.location="settings.htm"},newId,newKlasse);document.getElementById("item0").classList.remove("show");popUpClose(thisElement)}else{alert("Klassenname ung\xFCltig.")}}